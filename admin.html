<!DOCTYPE html>
<html lang="en">
<head>
    <!-- ... head content ... -->
</head>
<body class="bg-gray-100 font-sans">
    <!-- ... nav ... -->
    <div class="container mx-auto p-6">
        <!-- ... login section ... -->
        <main id="admin-panel-content" class="hidden">
            <!-- Tabs -->
            <div class="mb-6 border-b border-gray-200">
                <nav class="-mb-px flex space-x-4" aria-label="Tabs">
                    <button id="products-tab" class="text-gray-500 ...">Product Management</button>
                    <!-- NEW: Order Management Tab -->
                    <button id="orders-tab" class="tab-active ...">Order Management</button>
                    <button id="users-tab" class="text-gray-500 ...">User Management</button>
                </nav>
            </div>

            <!-- Product Management Section (initially hidden) -->
            <section id="product-management-section" class="hidden">
                <!-- ... all product management code ... -->
            </section>
            
            <!-- NEW: Order Management Section -->
            <section id="order-management-section">
                <div class="bg-white p-8 rounded-lg shadow-md">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Manage Customer Orders</h2>
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white border">
                            <thead>
                                <tr class="bg-gray-50">
                                    <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                                    <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase">Customer</th>
                                    <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase">Product</th>
                                    <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                    <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="adminOrderTableBody" class="divide-y divide-gray-200"></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- User Management Section (initially hidden) -->
            <section id="user-management-section" class="hidden">
                <!-- ... user management code ... -->
            </section>
        </main>
    </div>

    <!-- ... Edit Product Modal ... -->

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js';
        import { getAuth, ... } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js';
        import { getFirestore, ..., onSnapshot } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js';

        // ... firebase config and init ...
        
        // --- DOM Elements ---
        const ordersTab = document.getElementById('orders-tab');
        const orderManagementSection = document.getElementById('order-management-section');
        const adminOrderTableBody = document.getElementById('adminOrderTableBody');
        // ... other existing DOM refs

        // --- Tab Navigation Logic (UPDATED) ---
        ordersTab.addEventListener('click', () => {
            // ... hide other sections, show orders section, update tab styles
            fetchAdminOrders();
        });
        // ... other tab clicks
        
        // --- Auth Logic ---
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                // ... existing admin check
                if (isAdmin) {
                    // ... show admin panel
                    fetchAdminOrders(); // Fetch orders on initial login
                }
            }
        });
        
        // --- NEW: Order Management Functions ---
        const fetchAdminOrders = () => {
            const ordersQuery = query(collection(db, "orders"), orderBy("orderDate", "desc"));
            
            onSnapshot(ordersQuery, (snapshot) => {
                adminOrderTableBody.innerHTML = "";
                snapshot.forEach(doc => {
                    const order = { ...doc.data(), id: doc.id };
                    const orderDate = order.orderDate ? new Date(order.orderDate.seconds * 1000).toLocaleString() : 'N/A';
                    
                    let statusClass = '';
                    if (order.status === 'Pending') statusClass = 'bg-yellow-100 text-yellow-800';
                    if (order.status === 'Completed') statusClass = 'bg-green-100 text-green-800';
                    if (order.status === 'Rejected') statusClass = 'bg-red-100 text-red-800';

                    adminOrderTableBody.innerHTML += `
                        <tr>
                            <td class="py-4 px-6 text-sm text-gray-600">${orderDate}</td>
                            <td class="py-4 px-6 text-sm font-medium text-gray-900">${order.userEmail}</td>
                            <td class="py-4 px-6 text-sm text-gray-800">${order.productName}</td>
                            <td class="py-4 px-6"><span class="px-2 py-1 text-xs font-semibold rounded-full ${statusClass}">${order.status}</span></td>
                            <td class="py-4 px-6 text-sm space-x-2">
                                ${order.status === 'Pending' ? `
                                <button data-id="${order.id}" class="approve-order-btn bg-green-500 hover:bg-green-600 text-white py-1 px-3 rounded">Approve</button>
                                <button data-id="${order.id}" class="reject-order-btn bg-red-500 hover:bg-red-600 text-white py-1 px-3 rounded">Reject</button>
                                ` : `<span>-</span>`}
                            </td>
                        </tr>
                    `;
                });
            });
        };

        const handleOrderAction = async (orderId, newStatus) => {
            if (!confirm(`Are you sure you want to ${newStatus.toLowerCase()} this order?`)) return;
            
            const orderRef = doc(db, "orders", orderId);
            try {
                await updateDoc(orderRef, { status: newStatus });
                alert(`Order has been ${newStatus.toLowerCase()}.`);
            } catch (error) {
                console.error("Error updating order status: ", error);
                alert("Failed to update order.");
            }
        };

        // Event delegation for approve/reject buttons
        adminOrderTableBody.addEventListener('click', (e) => {
            const target = e.target;
            const orderId = target.dataset.id;
            
            if (target.classList.contains('approve-order-btn')) {
                handleOrderAction(orderId, 'Completed');
            }
            if (target.classList.contains('reject-order-btn')) {
                handleOrderAction(orderId, 'Rejected');
            }
        });
        
        // ... (rest of the admin panel code remains the same)
    </script>
</body>
</html>```
